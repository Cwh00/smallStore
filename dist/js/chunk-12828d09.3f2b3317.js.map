{"version":3,"sources":["webpack:///./src/views/category/Category.vue","webpack:///./src/network/category.js","webpack:///./src/views/category/Category.vue?9df4","webpack:///./src/views/category/Category.vue?115a"],"names":["class","default","tabActive","tabClick","title","sidebarActive","activeName","accordion","categories","item","key","id","name","children","sub","getCategory_id","showGoods","num","comments_count","tag","conments_count","price","desc","updated_at","thumb","cover_url","lazy-load","goDetail","backTop","isBackTopShow","getGoods","request","url","getCurrentGoods","order","category_id","page","setup","tabCurrentType","current_id","goodsList","sales","list","init","value","then","res","goods","data","bscroll","loading","message","clear","document","querySelector","probeType","click","pullUpLoad","on","position","y","console","log","push","finishPullUp","catch","err","refresh","index","tabTypes","Category_id","router","path","query","scrollTo","components","topNav","render"],"mappings":"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","file":"js/chunk-12828d09.3f2b3317.js","sourcesContent":["<template>\r\n    <div class=\"category\">\r\n        <top-nav>\r\n            <template v-slot:default>商品分类</template>\r\n        </top-nav>\r\n        <div class=\"tabOrder\">\r\n            <van-tabs v-model=\"tabActive\" @click=\"tabClick\">\r\n                <van-tab title=\"销量排序\"></van-tab>\r\n                <van-tab title=\"价格排序\"></van-tab>\r\n                <van-tab title=\"评论排序\"></van-tab>\r\n            </van-tabs>\r\n        </div>\r\n        <div class=\"content\">\r\n            <van-sidebar class=\"leftNav\" v-model=\"sidebarActive\">\r\n                <van-collapse v-model=\"activeName\" accordion> \r\n                    <van-collapse-item v-for=\"item in categories\" :key=\"item.id\"\r\n                    :title=\"item.name\" :name=\"item.name\">                        \r\n                        <van-sidebar-item v-for=\"sub in item.children\"\r\n                        :key=\"sub.id\"\r\n                        :title=\"sub.name\"\r\n                        @click=\"getCategory_id(sub.id)\"/>                        \r\n                        </van-collapse-item>\r\n                </van-collapse>\r\n            </van-sidebar>\r\n            <div class=\"goods\">\r\n                <div class=\"goods-content\">\r\n                    <van-card  v-for=\"item in showGoods\" :key=\"item.id\"\r\n                        :num=\"item.comments_count\"\r\n                        :tag=\"item.conments_count >= 1 ? '流行' : '推荐'\"\r\n                        :price=\"item.price+'.00'\"\r\n                        :desc=\"item.updated_at\"\r\n                        :title=\"item.title\"\r\n                        :thumb=\"item.cover_url\"\r\n                        :lazy-load=\"true\"\r\n                        @click=\"goDetail(item.id)\"\r\n                        />\r\n                </div>    \r\n            </div>                     \r\n        </div>\r\n        <back-top v-show=\"isBackTopShow\" @backTop=\"backTop\"></back-top>     \r\n    </div>\r\n</template>\r\n<script>\r\n    import backTop from 'components/common/backTop';\r\n    import { useRouter } from 'vue-router';\r\n    import { Toast } from 'vant';\r\n    import BScroll from 'better-scroll';\r\n    import topNav from 'components/content/topNav';\r\n    import { getGoods,getCurrentGoods } from 'network/category';\r\n    import { ref,onMounted,reactive,computed,nextTick } from 'vue';\r\n    export default {\r\n        name: 'Category',\r\n        setup() {\r\n            //初始化 排序选项卡索引、排序选项卡默认当前类型、分类商品列表、当前属分类id、商品数据模型、分类点击索引、分类子选项点击索引\r\n            let tabActive = ref(0);\r\n            let tabCurrentType = ref('sales');\r\n            let categories = ref([]);\r\n            //商品所属分类id，默认0为所有商品\r\n            let current_id = ref(0);\r\n            const goodsList = reactive({\r\n                sales:{page:1,list:[]},\r\n                price:{page:1,list:[]},\r\n                comments_count:{page:1,list:[]}\r\n            })\r\n            let activeName = ref('0');\r\n            let sidebarActive = ref(0)\r\n            //初始化得到排序商品、参数当前选项卡类型、商品所属分类id，初始值：sales排序的所有商品\r\n            const init =  ()=>{\r\n                return getCurrentGoods(tabCurrentType.value,current_id.value).then(res=>{\r\n                    goodsList[tabCurrentType.value].list = res.goods.data \r\n                })\r\n            }\r\n            //初始化bscroll\r\n            let bscroll = reactive({});\r\n            //实例挂载完成之后,获取所有分类列表、初始化排序商品、\r\n            onMounted(()=>{\r\n                Toast.loading({message: '正在加载'});\r\n                getGoods().then(res=>{\r\n                    categories.value = res.categories\r\n                });\r\n                Toast.clear();\r\n                init();\r\n                bscroll = new BScroll(document.querySelector('.goods'),{\r\n                    probeType: 3, //0、1、2、3,3滑动以及滑动过后的滚动都会触发scroll事件\r\n                    click: true,     //允许内容点击\r\n                    pullUpLoad: true, //默认是false，上拉加载\r\n                });\r\n                //滚动事件\r\n                bscroll.on('scroll',(position)=>{\r\n                    //判断当前窗口定位，使backtop显示出来\r\n                    isBackTopShow.value = (-position.y) > 400\r\n                });\r\n                //上拉加载事件\r\n                bscroll.on('pullingUp',()=>{\r\n                    //数据模型默认第一页，让加载从第二页开始，得到的数据结构赋值到数据模型list数组中，然后让分页加1\r\n                    let page = goodsList[tabCurrentType.value].page + 1;\r\n                    getCurrentGoods(tabCurrentType.value,current_id.value,page).then(res=>{\r\n                        console.log(res.goods.data)\r\n                        goodsList[tabCurrentType.value].list.push(...res.goods.data)\r\n                        goodsList[tabCurrentType.value].page += 1\r\n                        //每次获取完一页数据后，结束本次上拉加载\r\n                        bscroll.finishPullUp();\r\n                    }).catch(err=>{\r\n                        console.log(err);\r\n                    });\r\n                    //重新计算高度\r\n                    bscroll.refresh();\r\n                })\r\n            }) \r\n            //点击选项卡，通过索引修改选项卡当前类型\r\n            const tabClick = (index)=>{\r\n                let tabTypes = ['sales','price','comments_count']\r\n                tabCurrentType.value = tabTypes[index]\r\n                //请求当前选项卡数据\r\n                init();\r\n                //页面渲染完之后重新计算高度\r\n                nextTick(()=>{\r\n                    bscroll && bscroll.refresh()\r\n                });\r\n            }\r\n            //点击分类，通过传入的分类id修改当前分类id\r\n            const getCategory_id = (Category_id)=>{\r\n                current_id.value = Category_id\r\n                init();\r\n                nextTick(()=>{\r\n                    bscroll && bscroll.refresh()\r\n                });\r\n            }\r\n            const router = useRouter();\r\n            const goDetail = (id,title)=>{\r\n                router.push({path:'/Detail',query:{id,title}})\r\n            }\r\n            const showGoods = computed(()=>{\r\n                return goodsList[tabCurrentType.value].list\r\n            });\r\n            //返回顶部区域\r\n            let isBackTopShow = ref(false);\r\n            \r\n            const backTop = ()=>{\r\n                bscroll.scrollTo(0,0,500)\r\n            }\r\n            return {\r\n                tabActive,\r\n                activeName,\r\n                sidebarActive,\r\n                categories,\r\n                tabClick,\r\n                tabCurrentType,\r\n                getCategory_id,\r\n                showGoods,\r\n                init,\r\n                goDetail,\r\n                backTop,\r\n                isBackTopShow\r\n            }\r\n        },\r\n        components: {\r\n            topNav,\r\n            backTop\r\n        }\r\n    }\r\n</script>\r\n<style lang=\"scss\">\r\n.category {\r\n    .tabOrder {\r\n        width: 100%;\r\n        display:flex;\r\n        justify-content: flex-end;\r\n        padding: 5px 10px;\r\n        position: fixed;\r\n        top: 45px;\r\n        left: 0;\r\n        z-index: 9;\r\n        background: #fff;\r\n        box-shadow: 0px 1px 5px rgb(214, 214, 214);\r\n            .van-tab {\r\n                padding: 0px 10px;\r\n            }\r\n    }\r\n    .content {\r\n        width: 100%;\r\n        margin-top: var(--subcontent-margin-top);\r\n        margin-bottom: var(--content-margin-bottom);\r\n        .leftNav {\r\n            width: 30%;\r\n        }\r\n        .goods {\r\n            width: 70%;\r\n            position: fixed;\r\n            top: 100px;\r\n            right: 0;\r\n            bottom: 50px;\r\n        }\r\n    }\r\n    .goods-content .van-card .van-card__title {\r\n        text-align: left;\r\n        margin: 5px 0px;\r\n    }\r\n    .goods-content .van-card .van-card__price {\r\n        color: red;\r\n    }\r\n}\r\n</style>","import { request } from './request';\r\n\r\nexport function getGoods() {\r\n    return request({\r\n        url: '/api/goods'\r\n    })\r\n}\r\nexport function getCurrentGoods(order='sales',category_id=0,page=1) {\r\n    return request({\r\n        url: 'api/goods?category_id='+category_id+'&page='+page+'&'+order+'=1'\r\n    })\r\n}\r\n","import { render } from \"./Category.vue?vue&type=template&id=72d268e2\"\nimport script from \"./Category.vue?vue&type=script&lang=js\"\nexport * from \"./Category.vue?vue&type=script&lang=js\"\n\nimport \"./Category.vue?vue&type=style&index=0&id=72d268e2&lang=scss\"\nscript.render = render\n\nexport default script","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./Category.vue?vue&type=style&index=0&id=72d268e2&lang=scss\""],"sourceRoot":""}